USE "BLABLABLA";

CREATE OR REPLACE TABLE RJ_SALES_DATA_FINAL(
  order_id	VARCHAR2(20) PRIMARY KEY NOT NULL,
  order_date  DATE,
  ship_date	DATE,
  ship_mode	VARCHAR2(40),
  customer_name	VARCHAR2(40),
  segment	VARCHAR2(40),
  state	VARCHAR2(100),
  country	VARCHAR2(100),
  market	VARCHAR2(40),
  region	VARCHAR2(40),
  product_id	VARCHAR2(100),
  category	VARCHAR2(100),
  sub_category	VARCHAR2(100),
  product_name	VARCHAR2(200),
  sales	NUMBER(10,5),
  quantity	NUMBER(10,5),
  discount	NUMBER(10,5),
  profit	NUMBER(10,5),
  shipping_cost	NUMBER(10,5),
  order_priority	VARCHAR2(40),
  year NUMBER (10,5)
);

SELECT * FROM RJ_SALES_DATA_FINAL;

SELECT * ,
SUBSTRING(ORDER_ID,9) AS ORDER_ID_NUM,

CASE 
        WHEN DISCOUNT > 0 THEN 'YES'
        ELSE 'FALSE'
    END AS DISCOUNT_FLAG,
    
DATEDIFF('DAY',ORDER_DATE, SHIP_DATE) AS DAYS_FOR_SHIPMENT,
    
CASE 
    WHEN DAYS_FOR_SHIPMENT <= 3 THEN 5
    WHEN DAYS_FOR_SHIPMENT > 3 OR DAYS_FOR_SHIPMENT <= 6  THEN 4
    WHEN DAYS_FOR_SHIPMENT > 6 OR DAYS_FOR_SHIPMENT <= 10 THEN 3
    ELSE 2
END AS SHIPMENT_RATING,

CASE
    WHEN DISCOUNT > 0 THEN (((SALES*(1-DISCOUNT))-SHIPPING_COST-PROFIT)*QUANTITY)-(SALES*(1-DISCOUNT))   
    ELSE ((SALES-SHIPPING_COST-PROFIT)*QUANTITY)-SALES 
END AS FINAL_PROFIT

FROM RJ_SALES_DATA_FINAL;
